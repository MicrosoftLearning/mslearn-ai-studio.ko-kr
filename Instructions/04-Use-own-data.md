---
lab:
  title: 사용자 고유의 데이터를 사용하는 생성형 AI 앱 만들기
  description: RAG(검색 증강 생성) 모델을 사용하여 사용자 고유의 데이터로 프롬프트를 그라운딩하는 채팅 앱 빌드 방법을 알아봅니다.
---

# 사용자 고유의 데이터를 사용하는 생성형 AI 앱 만들기

RAG(검색 증강 생성)은 사용자 지정 데이터 소스의 데이터를 생성형 AI 모델에 대한 프롬프트에 통합하는 애플리케이션을 빌드하는 데 사용되는 기술입니다. RAG는 언어 모델을 사용하여 입력을 해석하고 적절한 응답을 생성하는 채팅 기반 애플리케이션인 생성형 AI 앱을 개발하는 데 일반적으로 사용되는 패턴입니다.

이 연습에서는 Azure AI 파운드리 포털, Azure AI 파운드리 및 Azure OpenAI SDK를 사용하여 사용자 지정 데이터를 생성형 AI 앱에 통합합니다.

이 연습에는 약 **45**분이 소요됩니다.

> **참고**: 이 연습은 변경될 수 있는 시험판 SDK를 기반으로 합니다. 필요한 경우 특정 버전의 패키지를 사용했으며, 이는 최신 버전이 반영되지 않을 수 있습니다.

## Azure AI 파운드리 프로젝트 만들기

먼저 Azure AI 파운드리 프로젝트 및 Azure AI 검색 리소스를 포함하여 사용자 고유의 데이터 사용을 지원하는 데 필요한 서비스 리소스를 만들어 보겠습니다.

1. 웹 브라우저에서 [Azure AI 파운드리 포털](https://ai.azure.com)(`https://ai.azure.com`)을 열고 Azure 자격 증명을 사용하여 로그인합니다. 처음 로그인할 때 열리는 팁이나 빠른 시작 창을 닫고 필요한 경우 왼쪽 위에 있는 **Azure AI 파운드리** 로고를 사용하여 다음 이미지와 유사한 홈 페이지로 이동합니다.

    ![Azure AI Foundry 포털의 스크린샷.](./media/ai-foundry-home.png)

1. 홈페이지에서 **+ 프로젝트 만들기**를 선택합니다.
1. **프로젝트 만들기** 마법사에서 적절한 프로젝트 이름(예: `my-ai-project`)을 입력하고 기존 허브가 추천되면 새 허브를 만드는 옵션을 선택합니다. 그런 다음 허브 및 프로젝트를 지원하기 위해 자동으로 만들어지는 Azure 리소스를 검토합니다.
1. **사용자 지정**을 선택하고 허브에 대해 다음 설정을 지정합니다.
    - **허브 이름**: *고유한 이름 - 예: `my-ai-hub`*
    - **구독**: ‘Azure 구독’
    - **리소스 그룹**: *고유한 이름(예: `my-ai-resources`)으로 새 리소스 그룹을 만들거나 기존 리소스 그룹 선택*
    - **위치**: **선택 도움말**을 선택한 다음 위치 도우미 창에서 **gpt-4**와 **text-embedding-ada-002**를 모두 선택하고 추천 지역을 사용합니다.\*
    - **Azure AI Services 또는 Azure OpenAI** 연결: *적절한 이름으로 새 AI Services 리소스를 만들거나(예 `my-ai-services`:) 기존 리소스를 사용합니다.*
    - **Azure AI 검색 연결**: *고유한 이름을 가진 새 Azure AI 검색 리소스 만들기*

    > \* Azure OpenAI 리소스는 지역 할당량에 따라 테넌트 수준에서 제한됩니다. 할당량 제한에 도달하고 두 모델 모두에 대해 지역이 권장되지 않는 경우 해당 모델 중 하나만 선택하고 권장되는 지역을 사용합니다. 연습의 뒷부분에서 두 번째 모델에 대해 다른 지역에 다른 리소스를 만들어 보겠습니다.

1. **다음**을 선택하여 구성을 검토합니다. **만들기**를 선택하고 프로세스가 완료될 때까지 기다립니다.
1. 프로젝트를 만들 때 표시되는 팁을 모두 닫고 Azure AI 파운드리 포털에서 프로젝트 **개요** 페이지를 검토합니다. 이 페이지는 다음 이미지와 유사합니다.

    ![Azure AI 파운드리 포털의 Azure AI 프로젝트 세부 정보 스크린샷.](./media/ai-foundry-project.png)
   
## 모델 배포

솔루션을 구현하려면 다음 두 가지 모델이 필요합니다.

- 효율적인 인덱싱 및 처리를 위해 텍스트 데이터를 벡터화하는 *임베딩* 모델입니다.
- 데이터에 따라 질문에 대한 자연어 응답을 생성할 수 있는 모델입니다.

1. Azure AI Foundry 포털의 프로젝트에 있는 왼쪽 탐색 창에서 **내 자산** 아래 **모델 + 엔드포인트** 페이지를 선택합니다.
1. 모델 배포 마법사에서 **사용자 지정**을 선택하여 다음 설정으로 **text-embedding-ada-002** 모델의 새 배포를 만듭니다.

    - **배포 이름**: `text-embedding-ada-002`
    - **배포 유형**: 표준
    - **모델 버전**: *기본 버전 선택*
    - **AI 리소스**: *이전에 만든 리소스 선택*
    - **분당 토큰 속도 제한(천 )**: 5K
    - **콘텐츠 필터**: DefaultV2
    - **동적 할당량 사용**: 사용할 수 없음

    > **참고**: 배포하려는 모델에 사용할 수 있는 할당량이 현재 AI 리소스 위치에 없는 경우 다른 위치를 선택하여 새 AI 리소스를 만들고 프로젝트에 연결하라는 메시지가 표시됩니다.

1. 이전 단계를 반복하여 기본 버전의 **표준** 배포를 사용하여 배포 이름이 `gpt-4`인 **GPT-4** 모델을 배포하고 TPM 속도 제한을 5K로 설정합니다.

    > **참고**: TPM(분당 토큰)을 줄이면 사용 중인 구독에서 사용 가능한 할당량을 과도하게 사용하지 않을 수 있습니다. 이 연습에 사용된 데이터는 5,000TPM이면 충분합니다.

## 프로젝트에 데이터 추가

Copilot 데이터는 가상의 여행사 *Margie's Travel*의 PDF 형식으로 된 여행 브로슈어 세트로 구성됩니다. 프로젝트에 이를 추가해 보겠습니다.

1. 새 브라우저 탭의 `https://github.com/MicrosoftLearning/mslearn-ai-studio/raw/main/data/brochures.zip`에서 [압축된 브로셔 아카이브](https://github.com/MicrosoftLearning/mslearn-ai-studio/raw/main/data/brochures.zip)를 다운로드하고 로컬 파일 시스템의 **브로셔**라는 폴더에 압축을 풉니다.
1. Azure AI Foundry 포털의 프로젝트에 있는 왼쪽 탐색 창에서 **내 자산** 아래 **데이터 + 인덱스** 페이지를 선택합니다.
1. **+ 새 데이터**를 선택합니다.
1. **데이터 추가** 마법사에서 드롭다운 메뉴를 확장하여 **파일/폴더 업로드**를 선택합니다.
1. **폴더 업로드**를 선택하고 **brochures** 폴더를 선택합니다.
1. **다음**을 선택하고 데이터 이름을 `brochures`(으)로 설정합니다.
1. 폴더가 업로드될 때까지 기다린 후 폴더에 여러 개의 .pdf 파일이 포함되어 있는지 확인합니다.

## 데이터에 대한 인덱스 만들기

이제 프로젝트에 데이터 원본을 추가했으므로 이 데이터 원본을 사용하여 Azure AI 검색 리소스에서 인덱스를 만들 수 있습니다.

1. Azure AI Foundry 포털의 프로젝트에 있는 왼쪽 탐색 창에서 **내 자산** 아래 **데이터 + 인덱스** 페이지를 선택합니다.
1. **인덱스** 탭에서 다음 설정을 사용하여 새 인덱스를 추가합니다.
    - **원본 위치**:
        - **데이터 원본**: Azure AI Foundry 포털의 데이터
            - ***brochures** 데이터 원본을 선택합니다.*
    - **인덱스 구성**:
        - **Azure AI 검색 서비스 선택**: *Azure AI 검색 리소스에 대한 **AzureAISearch** 연결을 선택합니다*.
        - **벡터 인덱스**: `brochures-index`
        - **가상 머신**: 자동 선택
    - **검색 설정**:
        - **벡터 설정**: 이 검색 리소스에 벡터 검색을 추가합니다.
        - **Azure OpenAI 연결**: *허브에 대한 기본 Azure OpenAI 리소스를 선택합니다.*
        - **포함 모델**: text-embedding-ada-002
        - **포함 모델 배포**: * text-embedding-ada-002 *모델*의 배포*

1. 구독에서 사용 가능한 컴퓨팅 리소스에 따라 다소 시간이 걸릴 수 있는 벡터 인덱스를 만들 인덱싱 프로세스가 완료될 때까지 기다립니다.

    인덱스 만들기 작업은 다음 작업으로 구성됩니다.

    - 브로슈어 데이터에 텍스트 토큰을 해독, 청크 및 포함합니다.
    - Azure AI 검색 인덱스 만들기
    - 인덱스 자산 등록

    > **팁**: 인덱스가 생성되기를 기다리는 동안 다운로드한 브로셔를 살펴보고 내용을 알아보는 것은 어떨까요?

## 플레이그라운드에서 인덱스 테스트

RAG 기반 프롬프트 흐름에서 인덱스를 사용하기 전에 인덱스를 사용하여 생성형 AI 응답에 영향을 줄 수 있는지 확인해 보겠습니다.

1. 왼쪽 탐색 창에서 **플레이그라운드** 페이지를 선택하고 **채팅** 플레이그라운드를 엽니다.
1. 채팅 플레이그라운드 페이지의 설정 창에서 **gpt-4** 모델 배포가 선택되어 있는지 확인합니다. 그런 다음 기본 채팅 세션 패널에서 프롬프트 `Where can I stay in New York?`를 제출합니다.
1. 응답을 검토합니다. 이때 응답은 인덱스의 데이터 없이 모델에서 생성된 일반적인 답변이어야 합니다.
1. 설정 창에서 **데이터 추가** 필드를 확장한 다음 **brochures-index** 프로젝트 인덱스를 추가하고 **하이브리드(벡터+키워드)** 검색 유형을 선택합니다.

   > **팁**: 경우에 따라 새로 만든 인덱스를 즉시 사용할 수 없습니다. 브라우저를 새로 고치면 일반적으로 도움이 되지만 인덱스를 찾을 수 없는 문제가 계속 발생하는 경우 인덱스가 인식될 때까지 기다려야 할 수도 있습니다.

1. 인덱스가 추가되고 채팅 세션이 다시 시작된 후 프롬프트 `Where can I stay in New York?`를 다시 제출합니다.
1. 응답을 검토합니다. 응답은 인덱스에 있는 데이터를 기반으로 해야 합니다.

## Azure AI 파운드리 및 Azure OpenAI SDK를 사용하여 RAG 클라이언트 앱 만들기

이제 작업 인덱스가 있으므로 Azure AI 파운드리 및 Azure OpenAI SDK를 사용하여 클라이언트 애플리케이션에서 RAG 패턴을 구현할 수 있습니다. 간단한 예제를 통해 이 작업을 수행하는 코드를 살펴보겠습니다.

> **팁**: Python 또는 Microsoft C#을 사용하여 RAG 솔루션을 개발하도록 선택할 수 있습니다. 선택한 언어의 해당 섹션에 있는 지침을 따릅니다.

### 애플리케이션 구성 준비

1. Azure AI 파운드리 포털에서 프로젝트의 **개요** 페이지를 봅니다.
1. **프로젝트 세부 정보** 영역에서 **프로젝트 연결 문자열**을 확인합니다. 이 연결 문자열 사용하여 클라이언트 응용 프로그램에서 프로젝트에 연결합니다.
1. 새 브라우저 탭을 엽니다(Azure AI 파운드리 포털을 기존 탭에서 열어 두기). 그런 다음 새 탭에서 [Azure Portal](https://portal.azure.com)(`https://portal.azure.com`)을 열고 메시지가 나타나면 Azure 자격 증명을 사용하여 로그인합니다.

    Azure Portal 홈페이지를 보려면 환영 알림을 닫습니다.

1. 페이지 상단의 검색 창 오른쪽에 있는 **[\>_]** 단추를 사용하여 Azure Portal에서 새 Cloud Shell을 만들고 구독에 저장소가 없는 ***PowerShell*** 환경을 선택합니다.

    Cloud Shell은 다음과 같이 Azure Portal 아래쪽 창에 명령줄 인터페이스를 제공합니다. 보다 쉽게 작업할 수 있도록 이 창의 크기를 조정하거나 최대화할 수 있습니다.

    > **참고**: 이전에 *Bash* 환경을 사용하는 Cloud Shell을 만든 경우 ***PowerShell***로 전환합니다.

1. Cloud Shell 도구 모음의 **설정** 메뉴에서 **클래식 버전으로 이동**을 선택합니다(코드 편집기를 사용하는 데 필요).

    **<font color="red">계속하기 전에 Cloud Shell의 클래식 버전으로 전환했는지 확인합니다.</font>**

1. PowerShell 창에서 다음 명령을 입력하여 이 연습의 코드 파일이 포함된 GitHub 리포지토리를 복제합니다.

    ```
    rm -r mslearn-ai-foundry -f
    git clone https://github.com/microsoftlearning/mslearn-ai-studio mslearn-ai-foundry
    ```

    > **팁**: CloudShell에 명령을 붙여넣으면 출력이 화면 버퍼의 많은 부분을 차지할 수 있습니다. `cls` 명령을 입력해 화면을 지우면 각 작업에 더 집중할 수 있습니다.

1. 리포지토리가 복제된 후 채팅 애플리케이션 코드 파일이 포함된 폴더로 이동합니다.

    > **참고**: 선택한 프로그래밍 언어에 대한 단계를 따릅니다.

    **Python**

    ```
   cd mslearn-ai-foundry/labfiles/rag-app/python
    ```

    **C#**

    ```
   cd mslearn-ai-foundry/labfiles/rag-app/c-sharp
    ```

1. Cloud Shell 명령줄 창에서 다음 명령을 입력하여 사용할 라이브러리를 설치합니다.

    **Python**

    ```
   pip install python-dotenv azure-ai-projects azure-identity openai
    ```

    **C#**

    ```
   dotnet add package Azure.Identity
   dotnet add package Azure.AI.Projects --prerelease
   dotnet add package Azure.AI.OpenAI --prerelease
    ```
    

1. 제공된 구성 파일을 편집하려면 다음 명령을 입력합니다.

    **Python**

    ```
   code .env
    ```

    **C#**

    ```
   code appsettings.json
    ```

    코드 편집기에서 파일이 열립니다.

1. 아래 코드에서 다음 자리 표시자를 바꿉니다. 
    - **your_project_connection_string**: 프로젝트의 연결 문자열로 바꿉니다(Azure AI Foundry 포털의 프로젝트 **개요** 페이지에서 복사함).
    - **your_model_deployment** 모델 배포에 할당한 이름(반드시 `gpt-4`이 되어야 함)으로 바꿉니다.
    - **your_index**: 인덱스 이름(반드시 `brochures-index`이 되어야 함)으로 바꿉니다.
1. 자리 표시자를 바꾼 후 코드 편집기에서 **CTRL+S** 명령 또는 **마우스 오른쪽 단추 클릭 > 저장**을 사용하여 변경 내용을 저장한 다음 **CTRL+Q** 명령 또는 **마우스 오른쪽 단추 클릭 > 종료**를 사용하여 Cloud Shell 명령줄을 열어둔 채 코드 편집기를 닫습니다.

### RAG 패턴을 구현하는 코드 탐색

1. 제공된 코드 파일을 편집하려면 다음 명령을 입력합니다.

    **Python**

    ```
   code rag-app.py
    ```

    **C#**

    ```
   code Program.cs
    ```

1. 파일의 코드를 검토하여 다음을 확인합니다.
    - Azure AI 파운드리 SK를 사용하여 프로젝트에 연결(프로젝트 연결 문자열 사용)
    - 프로젝트 연결에서 인증된 Azure OpenAI 클라이언트를 만듭니다.
    - 프로젝트에서 기본 Azure AI 검색 연결을 검색하여 Azure AI 검색 서비스의 엔드포인트와 키를 확인할 수 있습니다.
    - 적합한 시스템 메시지를 만듭니다.
    - Azure OpenAI 클라이언트에 프롬프트(사용자 입력을 기반으로 하는 시스템 및 사용자 메시지 포함)를 제출하고 프롬프트를 그라운딩하는 데 사용할 Azure AI 검색 인덱스에 대한 추가 정보를 추가합니다.
    - 그라운딩된 프롬프트의 응답을 표시합니다.
    - 채팅 기록에 응답을 추가합니다.
1. **Ctrl +Q** 명령을 사용하여 Cloud Shell 명령줄을 열어 두고 변경 사항을 저장하지 않은 채 코드 편집기를 닫습니다.

### 채팅 애플리케이션 실행

1. Cloud Shell 명령줄 창에서 다음 명령을 입력하여 앱을 실행합니다.

    **Python**

    ```
   python rag-app.py
    ```

    **C#**

    ```
   dotnet run
    ```

1. 메시지가 표시되면 `Where should I stay in London?`과 같은 질문을 입력하고 생성형 AI 모델의 응답을 검토합니다.

    응답에는 답변이 발견된 인덱싱된 데이터를 나타내는 원본 참조가 포함됩니다.

1. 예를 들어 후속 질문을 시도합니다. `What can I do there?` 

1. 완료되면 `quit`를 입력하여 프로그램을 종료합니다. 다음으로 Cloud Shell 창을 닫습니다.

## 정리

불필요한 Azure 비용 및 리소스 사용률을 방지하려면 이 연습에서 배포한 리소스를 제거해야 합니다.

1. Azure AI Foundry 탐색을 마쳤다면 [Azure Portal](https://portal.azure.com)(`https://portal.azure.com`)로 돌아가서, 필요한 경우 Azure 자격 증명을 사용하여 로그인합니다. 그런 다음 Azure AI 검색 및 Azure AI 리소스를 프로비전한 리소스 그룹의 리소스를 삭제합니다.
